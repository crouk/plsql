2003.DICIEMBRE
--------------------
1.ARIEKTA
-------------------

CREATE OR REPLACE PACKAGE BAT
AS
FUNCTION COSTE_LIBRO(V_ISBN TITLES.ISBN%TYPE) RETURN NUMBER;
PROCEDURE LIBROS_PUBLICADOS(URTE_A NUMBER, URTE_B NUMBER);
END;
/
CREATE OR REPLACE PACKAGE BODY BAT
AS
FUNCTION COSTE_LIBRO(V_ISBN TITLES.ISBN%TYPE) RETURN NUMBER
AS
	BAI TITLES.ISBN%TYPE;
	KOSTUA NUMBER(8,2);
	KOPURUA NUMBER;
	URTEA NUMBER (5);
BEGIN
	SELECT ISBN INTO BAI FROM TITLES WHERE ISBN=V_ISBN;
	IF SQL%FOUND THEN
		SELECT (TARIFA_PAG*NUM_PAG) INTO KOSTUA
		FROM AUTHORS A, TITLES T, TITLE_AUTHOR TA
		WHERE A.AU_ID=TA.AU_ID
		AND TA.ISBN=T.ISBN
		AND T.ISBN=V_ISBN;
		
		SELECT YEAR_PUBLISHED INTO URTEA FROM TITLES  WHERE ISBN=V_ISBN;
	
		SELECT COUNT(*) INTO KOPURUA
		FROM TITLES T, PUBLISHERS P
		WHERE T.PUBID=T.PUBID
		AND T.ISBN=V_ISBN
		AND YEAR_PUBLISHED=URTEA;	

		IF KOPURUA>5 THEN
			KOSTUA:=KOSTUA-KOSTUA*0.05;
		ELSIF KOPURUA>10 THEN
			KOSTUA:= KOSTUA-KOSTUA*0.1;
		ELSIF KOPURUA>20 THEN
			KOSTUA:=KOSTUA-KOSTUA*0.2;
		END IF;

	END IF;
	RETURN KOSTUA;
END;

PROCEDURE LIBROS_PUBLICADOS(URTE_A NUMBER, URTE_B NUMBER)
AS
	CURSOR C IS
		SELECT T.TITLE,P.NAME,A.AUTHOR
		FROM AUTHORS A,TITLES T, PUBLISHERS P, TITLE_AUTHOR TA
		WHERE P.PUBID=T.PUBID
		AND T.ISBN=TA.ISBN
		AND TA.AU_ID=A.AU_ID
		AND T.YEAR_PUBLISHED BETWEEN URTE_A AND URTE_B
		ORDER BY T.TITLE;
BEGIN
	DBMS_OUTPUT.PUT_LINE('LIBURUEN INFORMAZIAO');
	DBMS_OUTPUT.PUT_LINE('*******************************');
	FOR I IN C LOOP
		DBMS_OUTPUT.PUT_LINE('EDITORIALA: '||I.TITLE);
		DBMS_OUTPUT.PUT_LINE('IZENBURUA: '||I.NAME);
		DBMS_OUTPUT.PUT_LINE('EGILEA: '||I.AUTHOR);
		DBMS_OUTPUT.PUT_LINE('*******************************');
	END LOOP;
END;
END;